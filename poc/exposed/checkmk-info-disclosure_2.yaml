id: checkmk-info-disclosure

info:
  name: Checkmk Agent Info Disclosure
  author: ivaldivieso
  severity: medium
  description: |
    The Checkmk agent had exposed sensitive system information on TCP port 6556 without requiring authentication.
  reference:
    - https://medium.com/@Th3hound/the-hidden-danger-of-the-exposed-checkmk-agent-mapping-your-infrastructure-for-attackers-151cc2180e73
  metadata:
    verified: true
    shodan-query: product:"check_mk"
  tags: tcp,network,checkmk,unauth,discovery

tcp:
  - inputs:
      - data: "\n"

    host:
      - "{{Hostname}}"
    port: 6556
    read-size: 1024

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "<<<check_mk>>>"
          - "AgentOS:"
          - "Version:"
        condition: or

      - type: word
        words:
          - "HTTP/1.1"
        negative: true
# digest: 4a0a004730450221009819599a070c947daaf4c1f9572ea89847b154e27b3b3ce5d6e9e1a740fd0ac202206b066cc1d292d040e931c88aae896fdeb6c1837578bd2402d8a7d3c73575fb31:922c64590222798bb761d5b6d8e72950